<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GATE MCQ Builder (Paste Prompt → Quiz)</title>
<style>
  :root{--gap:14px;--radius:12px;--shadow:0 6px 18px rgba(0,0,0,.08)}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f7f7fb;color:#222}
  header{position:sticky;top:0;z-index:2;background:#fff;border-bottom:1px solid #eaeaea}
  .bar{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;gap:12px;align-items:center}
  .bar h1{font-size:16px;margin:0;font-weight:600;white-space:nowrap}
  .score{margin-left:auto;font-weight:700}
  .wrap{max-width:1100px;margin:18px auto;padding:0 16px 24px}
  textarea{width:100%;min-height:220px;padding:14px;border:1px solid #ddd;border-radius:10px;resize:vertical;font:14px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  .controls{display:flex;gap:10px;margin:10px 0 22px}
  button{border:0;background:#1a73e8;color:#fff;padding:10px 16px;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:var(--shadow)}
  button.secondary{background:#6c757d}
  button:disabled{opacity:.6;cursor:not-allowed}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
  .card{background:#fff;border:1px solid #eee;border-radius:var(--radius);box-shadow:var(--shadow);display:flex;flex-direction:column}
  .card .q{padding:14px 14px 6px;border-bottom:1px solid #f1f1f1}
  .q .meta{font-size:12px;color:#666;margin-bottom:6px}
  .q h3{margin:0 0 6px;font-size:16px}
  .opts{display:flex;flex-direction:column;gap:8px;padding:12px}
  .opt{border:1px solid #ddd;border-radius:10px;padding:10px 12px;background:#fafafa;cursor:pointer;text-align:left}
  .opt.correct{border-color:#28a745;background:#e8f7ec}
  .opt.wrong{border-color:#dc3545;background:#fdebec}
  .opt.disabled{opacity:.7;pointer-events:none}
  .ans{border-top:1px dashed #e6e6e6;margin-top:8px;padding:12px;display:none;background:#fcfcff;border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius)}
  .ans.show{display:block}
  .ans strong{display:inline-block;min-width:78px}
  .title{font-weight:700;margin:4px 0 14px}
  .notice{font-size:13px;color:#555;margin:10px 0}
  .footer{margin-top:20px;font-size:12px;color:#777;text-align:center}
  .chip{display:inline-block;background:#eef3ff;color:#1a73e8;border:1px solid #d9e3ff;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}
</style>
</head>
<body>
  <header>
    <div class="bar">
      <h1>GATE MCQ Builder</h1>
      <div id="titleChip" class="chip" style="display:none"></div>
      <div class="score">Score: <span id="score">0</span></div>
    </div>
  </header>

  <div class="wrap">
    <p class="notice">Paste your formatted prompt (questions + “Answer Key & Explanations”) then click <b>Build Quiz</b>. Scoring: <b>+1</b> correct, <b>+2/3</b> incorrect.</p>
    <textarea id="input" placeholder="Paste the MCQ prompt here..."></textarea>
    <div class="controls">
      <button id="buildBtn">Build Quiz</button>
      <button id="resetBtn" class="secondary">Reset</button>
    </div>

    <div id="quiz" class="grid"></div>
    <div class="footer">Single-page MCQ Builder • Works offline • Paste → Build → Practice</div>
  </div>

<script>
(() => {
  const el = (tag, cls, html) => {
    const e = document.createElement(tag);
    if (cls) e.className = cls;
    if (html != null) e.innerHTML = html;
    return e;
  };

  const scoreEl = document.getElementById('score');
  const quizEl  = document.getElementById('quiz');
  const inputEl = document.getElementById('input');
  const buildBtn= document.getElementById('buildBtn');
  const resetBtn= document.getElementById('resetBtn');
  const titleChip= document.getElementById('titleChip');

  let score = 0;

  function setScore(delta){
    score = Math.round((score + delta) * 1000) / 1000; // keep 3 dp
    scoreEl.textContent = score;
  }

  function resetAll(){
    score = 0; scoreEl.textContent = '0';
    quizEl.innerHTML = '';
    titleChip.style.display = 'none';
    titleChip.textContent = '';
  }

  resetBtn.addEventListener('click', resetAll);

  buildBtn.addEventListener('click', () => {
    try {
      resetAll();
      const text = inputEl.value.trim();
      if(!text){ alert('Please paste the prompt first.'); return; }
      const data = parsePrompt(text);
      if(!data.questions.length || !Object.keys(data.answers).length){
        alert('Could not parse questions/answers. Please ensure the format matches your sample.');
        return;
      }
      if (data.title){
        titleChip.style.display = 'inline-block';
        titleChip.textContent = data.title;
      }
      renderQuiz(data);
      window.scrollTo({top:quizEl.offsetTop - 60, behavior:'smooth'});
    } catch (e){
      console.error(e);
      alert('Parse error. Please check the prompt format.');
    }
  });

  // ---------- Parsing ----------
  function parsePrompt(raw){
    const res = { title:'', questions:[], answers:{} };

    // Title from first markdown heading line
    const titleMatch = raw.match(/^\s*(?:#+\s*)?(.+MCQ.*)\s*$/mi);
    if (titleMatch) res.title = titleMatch[1].trim();

    // Split questions part and answers part at "Answer Key & Explanations"
    const splitter = /(?:^|\n)#{1,3}\s*Answer Key\s*&\s*Explanations.*$/i;
    const parts = raw.split(splitter);
    const qPart = parts[0] || raw;
    const aPart = parts[1] || '';

    // Extract question blocks beginning with "#### Qn."
    const blocks = qPart.split(/\n\*{3,}\n/g); // split by *** separators
    const qBlocks = blocks.filter(b => /####\s*Q\s*\d+/i.test(b));

    qBlocks.forEach(b=>{
      const qNumMatch = b.match(/####\s*Q\s*(\d+)\.\s*(.*)/i);
      if(!qNumMatch) return;
      const qnum = parseInt(qNumMatch[1],10);
      const qtext = qNumMatch[2].trim();

      // Options: lines starting with (A)...(D) (tolerate spaces)
      const opts = {};
      const optRegex = /^\s*\(?([A-D])\)?[.)]?\s*(.+)\s*$/i;
      const lines = b.split('\n').map(s=>s.trim()).filter(Boolean);
      lines.forEach(line=>{
        const m = line.match(optRegex);
        if(m){
          const key = m[1].toUpperCase();
          opts[key] = m[2];
        }
      });

      if(Object.keys(opts).length===4){
        res.questions.push({qnum, qtext, options:[
          {key:'A', text:opts['A']},
          {key:'B', text:opts['B']},
          {key:'C', text:opts['C']},
          {key:'D', text:opts['D']}
        ]});
      }
    });

    // Parse answers: lines like "Q1 → Ans: B | GATE 2021 | Exp: ... | Shortcut: ... | Level: Easy"
    const lines = aPart.split('\n').map(s=>s.trim()).filter(Boolean);
    lines.forEach(line=>{
      // normalize arrow and separators
      const norm = line.replace(/→/g,'->').replace(/\|/g,'|');
      const m = norm.match(/^Q\s*(\d+)[^A]*Ans\s*[:\-]\s*([A-D])/i);
      if(!m) return;
      const qn = parseInt(m[1],10);
      const ans = m[2].toUpperCase();

      // Extract tags
      const yearMatch = norm.match(/GATE\s*\d{4}/i);
      const newMatch  = /New Q/i.test(norm) ? 'New Q' : '';
      const expMatch  = norm.match(/Exp\s*[:\-]\s*(.*?)(?:\s*\|\s*Shortcut|\s*\|\s*Level|$)/i);
      const scMatch   = norm.match(/Shortcut\s*[:\-]\s*(.*?)(?:\s*\|\s*Level|$)/i);
      const lvlMatch  = norm.match(/Level\s*[:\-]\s*(\w+)/i);

      res.answers[qn] = {
        correct: ans,
        year: yearMatch ? yearMatch[0] : (newMatch || ''),
        exp: expMatch ? expMatch[1].trim() : '',
        shortcut: scMatch ? scMatch[1].trim() : '',
        level: lvlMatch ? lvlMatch[1] : ''
      };
    });

    // Sort questions by qnum
    res.questions.sort((a,b)=>a.qnum-b.qnum);
    return res;
  }

  // ---------- Render ----------
  function renderQuiz(data){
    quizEl.innerHTML = '';
    data.questions.forEach(q=>{
      const card = el('div','card');
      const qTop = el('div','q');
      const meta = el('div','meta', `${data.answers[q.qnum]?.year || ''} ${data.answers[q.qnum]?.level ? '• '+data.answers[q.qnum].level : ''}`);
      const h3 = el('h3','', `Q${q.qnum}. ${escapeHTML(q.qtext)}`);
      qTop.appendChild(meta); qTop.appendChild(h3);

      const opts = el('div','opts');
      q.options.forEach(opt=>{
        const btn = el('button','opt', `<b>(${opt.key})</b> ${escapeHTML(opt.text)}`);
        btn.addEventListener('click', ()=>{
          if(btn.classList.contains('disabled')) return;
          // lock all options for this card
          const all = opts.querySelectorAll('.opt');
          all.forEach(b=>b.classList.add('disabled'));

          const correctKey = (data.answers[q.qnum]?.correct || '').toUpperCase();
          if (opt.key === correctKey){
            btn.classList.add('correct');
            setScore(1);
          } else {
            btn.classList.add('wrong');
            // mark correct one for visibility
            const corrBtn = Array.from(all).find(b => b.textContent.trim().startsWith(`(${correctKey})`));
            if(corrBtn) corrBtn.classList.add('correct');
            setScore(2/3);
          }
          // reveal answer panel
          ans.classList.add('show');
        });
        opts.appendChild(btn);
      });

      const ansData = data.answers[q.qnum] || {};
      const ans = el('div','ans');
      ans.innerHTML = `
        <div class="title">Answer & Steps</div>
        <div><strong>Answer:</strong> (${ansData.correct || '?'}) ${ansData.year ? ' | '+escapeHTML(ansData.year):''} ${ansData.level ? ' | Level: '+escapeHTML(ansData.level):''}</div>
        ${ansData.exp ? `<div><strong>Explanation:</strong> ${escapeHTML(ansData.exp)}</div>`:''}
        ${ansData.shortcut ? `<div><strong>Shortcut:</strong> ${escapeHTML(ansData.shortcut)}</div>`:''}
      `;

      card.appendChild(qTop);
      card.appendChild(opts);
      card.appendChild(ans);
      quizEl.appendChild(card);
    });
  }

  function escapeHTML(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }
})();
</script>
</body>
</html>
